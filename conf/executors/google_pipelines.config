google {
    lifeSciences.bootDiskSize = 100.GB
    lifeSciences.preemptible = true
    zone = 'us-east1-b'
    network = 'jax-poc-lifebit-01-vpc-network'
    subnetwork = 'us-east1'
}

docker.enabled = true

process {
	
    cache = 'lenient'

    errorStrategy = 'retry'
    maxRetries = 3

    executor = 'google-lifesciences'
    
    container = 'nfcore/rnaseq:1.3'

    withName: 'getAccession' {
        container = 'gcr.io/nextflow-250616/sratools'
        cpus = 8
        memory = '30 GB'
    }
    withName: 'trimming' {
        container = 'gcr.io/nextflow-250616/fastp:latest'
        cpus = 8
        memory = '31 GB'
    }
    withName: 'mapping' {
        errorStrategy = 'ignore'
        container = 'gcr.io/nextflow-250616/hisat2index:samtools'
        cpus = 24
        memory = '60 GB'
    }
    withName: 'sortbam' {
        cpus = 8
        memory = '30 GB'
    }
    withName: 'markduplicates' {
        errorStrategy = 'finish'
        cpus = 10
        memory = { 32.GB * task.attempt as nextflow.util.MemoryUnit }
    }
    withName: 'paired_rmats' {
        cpus = 16
        memory = '60 GB'
    }
    withName: 'sampleCountsSave' {
        cpus = 1
        memory = '2 GB'
    }
    withName: 'createMatrices' {
        executor = 'ignite'
        cpus = 1
        memory = '2 GB'
    }
    withLabel: 'rmats' {
        container = 'pprietob/rmats:latest'
    }
    withLabel: 'rmats' {
        container = 'pprietob/postrmats:latest'
    }
}
